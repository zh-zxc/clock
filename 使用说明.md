# 时钟应用使用说明

## 📋 项目概述

这是一个功能丰富的时钟应用，包含：
- 🕐 实时数字时钟
- 📅 日历记事本
- 💰 消费记录
- ☁️ WebDAV云盘同步（支持Infini Cloud）
- 🔒 数据加密（AES-256）

## 🚀 快速开始

### 1. 直接使用（推荐）
直接在浏览器中打开 `index_new.html` 文件即可使用，无需服务器。

### 2. 使用服务器
```bash
cd 时钟
python3 server.py
```
然后访问：http://localhost:3000/index_new.html

## 🎯 核心功能

### 时钟
- 实时显示当前时间（每秒更新）
- 显示完整日期信息（年月日+星期）

### 日历
- 点击 `<` 和 `>` 切换月份
- 点击日期选择查看或添加数据
- 日期上的标记：
  - 🔵 蓝色圆点：有记事
  - 🟣 粉色圆点：有消费记录
  - 🟢 绿色：今天
  - 🔵 蓝色渐变：选中日期

### 记事本
- 在文本框中输入记事内容
- 点击"保存记事"或按 Ctrl+Enter 保存
- 点击 `×` 删除记事

### 消费记录
- 输入金额和描述
- 点击"记录消费"或按 Ctrl+Enter 保存
- 点击 `×` 删除记录
- 自动统计：本日消费、本月消费、平均每日

## ☁️ WebDAV云盘同步

### 配置步骤

#### 1. 获取Infini Cloud应用密码
1. 登录 Infini Cloud 网页版
2. 进入"账户设置"
3. 找到"应用密码"或"安全设置"
4. 生成新的应用密码
5. **复制该密码**（不是登录密码）

#### 2. 配置WebDAV连接
在WebDAV配置区域填写：
- **服务器地址**：`https://rebun.infini-cloud.net/dav/`（已固定）
- **用户名**：您的Infini Cloud邮箱地址
- **应用密码**：您刚生成的应用密码
- **同步路径**：`/clock-data/`（可选）
- **启用数据加密**：推荐勾选
- **加密密钥**：可留空使用默认密钥

#### 3. 连接并同步
1. 点击"连接 WebDAV"按钮
2. 等待连接成功（状态变为绿色）
3. **首次使用**：点击"上传数据"将本地数据上传到云端
4. **日常使用**：点击"🔄 同步"按钮自动同步

### 同步方式

#### 自动同步（推荐）
- 点击右上角"🔄 同步"按钮
- 系统会自动比较本地和云端数据
- 选择最新的数据进行同步

#### 手动同步
- **上传数据**：将本地数据上传到云端（覆盖云端）
- **下载数据**：从云端下载数据到本地（覆盖本地）

### 数据加密
- 使用AES-256-GCM算法加密数据
- 即使云盘被入侵，数据也无法被读取
- 请妥善保管加密密钥，丢失后无法恢复数据

## 🔧 连接问题解决

### 错误：401 Unauthorized
**原因**：认证失败
**解决方案**：
1. 确认使用的是**应用密码**，不是登录密码
2. 确认用户名是邮箱格式
3. 重新生成应用密码

### 错误：网络错误
**原因**：CORS跨域限制
**解决方案**：
1. 安装浏览器扩展 "CORS Unblock" 或 "Allow CORS"
2. 启用扩展后重新连接

### 错误：文件不存在
**原因**：首次使用云端没有数据文件
**解决方案**：
1. 点击"上传数据"创建文件
2. 或点击"下载数据"（会自动创建）

## 💾 本地备份（备用方案）

如果WebDAV无法连接，使用本地备份工具：

### 使用步骤
1. 打开 `local-backup.html` 文件
2. **导出数据**：点击"导出数据到文件"
3. **保存备份**：将下载的JSON文件保存到云盘
4. **恢复数据**：需要时选择备份文件恢复

### 备份建议
- 定期备份（建议每周一次）
- 多处备份（多个云盘）
- 重要数据立即备份

## ⌨️ 快捷键

- **Ctrl+Enter**：在记事本或消费输入框中快速保存
- **Enter**：在消费金额输入框中跳转到描述框
- **Tab/Shift+Tab**：在表单元素间导航

## 🎨 主题切换

点击右上角"🌓 切换主题"按钮：
- **深色模式**：黑色背景 + 闪烁星空
- **浅色模式**：蓝天白云背景

## 📊 数据统计说明

### 本日消费
- 所选日期的消费总和

### 本月消费
- 当前月份所有日期的消费总和

### 平均每日
- 本月消费 ÷ 有消费的天数

## 🔒 数据安全

### 加密机制
- 算法：AES-256-GCM
- 密钥派生：PBKDF2（100,000次迭代）
- 随机IV（初始化向量）
- Base64编码存储

### 密钥管理
- 默认密钥：`ClockAppDefaultKey2024!`
- 建议使用自定义密钥
- 请妥善保管密钥
- 密钥不会上传到云端

## 📁 文件说明

### 主要文件
- `index_new.html` - 主应用文件（全新设计）
- `local-backup.html` - 本地备份工具
- `proxy-server.js` - 本地代理服务器（备用）
- `WEBDAV指南.md` - WebDAV详细指南
- `使用说明.md` - 本文件

### 服务器文件
- `server.py` - Python服务器
- `server.js` - Node.js服务器
- `package.json` - Node.js配置

## 🌐 浏览器兼容性

- Chrome 60+
- Firefox 55+
- Safari 12+
- Edge 79+
- 移动端浏览器

## 📝 常见问题

### Q: 数据存储在哪里？
A: 数据存储在浏览器的localStorage中，清除浏览器数据会丢失。

### Q: 如何永久保存数据？
A: 使用WebDAV同步到云端，或使用本地备份工具导出JSON文件。

### Q: 忘记加密密钥怎么办？
A: 无法恢复数据，请务必妥善保管密钥。

### Q: 可以在多台设备间同步吗？
A: 可以，使用WebDAV同步功能即可。

### Q: Infini Cloud免费吗？
A: Infini Cloud提供免费存储空间，具体请查看其官网。

## 💡 使用建议

1. **首次使用**：
   - 先添加一些记事和消费记录
   - 配置WebDAV连接
   - 点击"上传数据"备份到云端

2. **日常使用**：
   - 定期点击"🔄 同步"按钮
   - 重要数据立即备份
   - 使用本地备份工具作为双重保险

3. **数据恢复**：
   - 如果同步失败，使用本地备份工具
   - 将备份文件保存到多个云盘

## 🆘 获取帮助

如果遇到问题：
1. 查看同步日志获取详细信息
2. 参考WEBDAV指南.md
3. 检查浏览器控制台（F12）
4. 确认网络连接正常

## 📅 更新日志

### v2.0.0 - 2026-01-20
- ✨ 全新设计的用户界面
- ✨ 优化的WebDAV连接逻辑
- ✨ 增强的错误处理和提示
- ✨ 简化的操作流程
- ✨ 响应式设计，支持移动端

---

**祝您使用愉快！** 🎉
