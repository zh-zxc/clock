# 数字时钟与日历记事本

一个功能丰富的网页应用，包含实时数字时钟、日历和记事本功能。经过全面优化，具有更好的性能、可维护性和用户体验。

## ✨ 功能特性

### 🕐 核心功能
- **实时数字时钟**：显示当前时间（小时:分钟:秒），每秒自动更新，作为界面核心元素突出显示
- **日历组件**：可查看任意月份的日历，支持月份切换，采用紧凑设计减少占位
- **记事本功能**：为特定日期添加、查看和删除记事
- **消费记录功能**：记录和查看特定日期的消费情况，包含统计信息

### ☁️ WebDAV云盘同步
- **双向同步**：支持上传、下载和合并数据，智能处理冲突
- **数据加密**：使用AES-256算法加密数据，保护隐私安全
- **多云盘支持**：兼容所有支持WebDAV协议的云盘（坚果云、Nextcloud、OwnCloud等）
- **自动连接**：保存配置，下次自动连接
- **同步日志**：详细的同步过程记录，便于排查问题

### 🎨 视觉与交互
- **主题切换**：
  - 深色模式：黑色星空背景 + 闪烁星星动画，适合夜间使用
  - 浅色模式：蓝天白云背景 + 漂浮云朵动画，适合白天使用
- **响应式设计**：完美适配手机、平板和桌面设备
- **增强交互体验**：按钮具有水波动画和悬停效果，提升用户操作感知
- **双击快速记录**：双击日历日期可快速添加消费记录

### 💾 数据管理
- **数据持久化**：使用浏览器localStorage保存记事和消费数据
- **本地存储**：所有数据保存在浏览器本地，保护用户隐私
- **自动统计**：实时计算本日、本月消费和平均每日消费

## 🚀 技术优化

### 前端优化
- **模块化架构**：采用面向对象设计，代码结构清晰
  - `DataManager`：数据管理器，处理localStorage读写
  - `BackgroundManager`：背景管理器，处理星空/云朵动画
  - `CalendarManager`：日历管理器，处理日历渲染和交互
  - `ClockManager`：时钟管理器，处理时间更新
  - `ListRenderer`：列表渲染器，统一处理列表显示
  - `StatsManager`：统计管理器，处理消费统计
  - `ClockApp`：主应用类，协调各模块
- **性能优化**：
  - DOM缓存：避免重复查询DOM元素
  - 事件委托：减少事件监听器数量
  - DocumentFragment：批量DOM操作，减少重绘
  - will-change：优化CSS动画性能
  - 防抖函数：防止频繁操作
- **代码质量**：
  - 完整的JSDoc注释
  - 错误处理和异常捕获
  - 安全的JSON解析和字符串化
  - XSS防护：HTML内容转义
  - 类型检查和验证

### 后端优化
#### Python服务器 (server.py)
- **增强功能**：
  - 完整的MIME类型映射
  - 自定义请求处理器
  - CORS跨域支持
  - 安全响应头（X-Content-Type-Options, X-Frame-Options）
  - 缓存控制（开发环境）
  - 优雅的错误处理
  - 支持自定义端口参数
  - 详细的启动信息和网络接口显示
- **错误处理**：
  - 端口占用检测
  - 客户端断开连接处理
  - 请求处理异常捕获
  - 友好的错误页面

#### Node.js服务器 (server.js)
- **增强功能**：
  - 完整的MIME类型映射
  - 路径遍历攻击防护
  - 默认文件查找（index.html, default.html）
  - CORS跨域支持
  - 安全响应头
  - 缓存控制
  - 美观的错误页面
  - 自动获取本机IP用于局域网访问
  - 支持环境变量配置端口
- **错误处理**：
  - 端口占用检测
  - 文件访问错误处理
  - 404/403/500错误页面
  - 详细的错误日志

## 📁 项目结构

```
时钟/
├── index.html      # 主页面文件（包含所有HTML、CSS、JavaScript）
├── server.py       # Python本地服务器（端口3000，支持自定义端口）
├── server.js       # Node.js本地服务器（端口3000，支持环境变量）
├── package.json    # Node.js项目配置
├── README.md       # 项目说明文档
└── .gitignore      # Git忽略文件配置
```

## 🌐 使用方法

### 1. 直接打开（推荐）
直接在浏览器中打开 `index.html` 文件，无需服务器。

### 2. 使用Python运行
```bash
# 使用默认端口3000
python3 server.py

# 使用自定义端口
python3 server.py 8080
```

然后在浏览器中访问 `http://localhost:3000`

### 3. 使用Node.js运行
```bash
# 使用默认端口3000
node server.js

# 使用环境变量指定端口
PORT=8080 node server.js

# 或使用npm命令
npm start
```

然后在浏览器中访问 `http://localhost:3000`

### 4. 局域网访问
启动服务器后，会显示本机IP地址，其他设备可以通过该IP访问：
```
http://[你的IP地址]:3000
```

## 🎯 功能操作指南

### 时钟
- 实时显示当前时间，每秒自动更新
- 同时显示完整的日期信息（年月日+星期）

### 日历操作
- 点击"< 上月"和"下月 >"按钮切换月份
- 点击具体日期可在记事本和消费记录中查看或添加该日期的相关内容
- 日期右下角的标记点表示该日期有记事（蓝色）或消费记录（粉色）
- **双击日期**：快速添加消费记录（弹出提示框）

### 记事本操作
- 在文本框中输入记事内容
- 点击"保存记事"按钮保存（或使用 Ctrl+Enter 快捷键）
- 点击记事旁的"✕"按钮删除记事

### 消费记录操作
- 输入消费金额和描述
- 点击"记录消费"按钮保存（或使用 Ctrl+Enter 快捷键）
- 点击消费记录旁的"✕"按钮删除记录
- 底部显示当日、当月消费统计信息

### WebDAV云盘同步（实验性功能）
由于浏览器跨域限制，WebDAV直接连接可能无法正常工作。建议使用以下替代方案：

**推荐方案：本地备份工具**
- 打开 `local-backup.html` 文件
- 支持导出数据到JSON文件
- 支持从文件恢复数据
- 支持复制到剪贴板/从剪贴板恢复
- 可将备份文件保存到任意云盘（百度网盘、阿里云盘等）

**WebDAV连接（如需尝试）**：
1. 在"云盘同步 (WebDAV)"区域填写WebDAV服务器地址
  2. 输入用户名和密码（如果是坚果云，使用应用密码）
  3. 设置同步路径（可选，默认为 `/clock-data/`）
  4. 选择是否启用数据加密（推荐启用）
  5. 如需自定义加密密钥，在加密密钥框中输入（留空使用默认密钥）
  6. 点击"连接 WebDAV"按钮

- **Infini Cloud 配置**：
  - WebDAV服务器地址：`https://rebun.infini-cloud.net/dav/`（已固定）
  - 用户名：您的Infini Cloud用户名/邮箱
  - 密码：您的Infini Cloud密码（建议使用应用密码）
  - 同步路径：可选，默认为 `/clock-data/`

- **同步操作**：
  - **上传数据**：将本地数据上传到云端（覆盖云端）
  - **下载数据**：从云端下载数据到本地（覆盖本地）
  - **加密数据**：单独加密本地数据并保存备份
  - **清空本地**：删除所有本地数据（谨慎操作）
  - **快速同步**：点击右上角"同步"按钮，自动判断上传或下载

- **同步状态**：
  - 顶部状态栏显示连接和同步状态
  - 同步日志显示详细的操作记录
  - 绿色表示成功，红色表示错误，黄色表示警告

- **数据加密**：
  - 使用AES-256-GCM算法加密
  - 支持自定义密钥或使用默认密钥
  - 加密后的数据以Base64编码存储
  - 即使云盘被入侵，数据也无法被读取

- **连接问题解决**：
  - **本地代理服务器（推荐）**：使用提供的 `proxy-server.js` 启动本地代理
  - **CORS代理**：应用会自动尝试使用多个CORS代理服务
  - **浏览器扩展**：安装 "CORS Unblock" 或 "Allow CORS" 浏览器扩展
  - 如果所有代理都失败，请检查网络连接或WebDAV服务器配置
  - 建议在桌面浏览器中使用，移动端可能需要VPN

### 主题切换
- 点击右上角的"切换到浅色模式"/"切换到深色模式"按钮切换主题
- 深色模式：黑色背景配闪烁星空

## ⌨️ 键盘快捷键

- **Ctrl+Enter**：在记事本或消费记录输入框中快速保存
- **Enter**：在消费金额输入框中跳转到描述输入框
- **Tab/Shift+Tab**：在表单元素间导航
- **Enter/Space**：在日历日期上触发点击（无障碍支持）

## 🌐 浏览器兼容性

- Chrome 60+
- Firefox 55+
- Safari 12+
- Edge 79+
- 移动端浏览器（iOS Safari, Chrome Mobile）

## 📊 性能特点

- **零依赖**：纯原生技术栈，无需任何外部库
- **轻量级**：单文件部署，加载速度快
- **离线可用**：所有功能在浏览器本地运行
- **响应式**：自适应各种屏幕尺寸
- **高性能**：优化的DOM操作和动画性能

## 🔒 安全特性

- **XSS防护**：用户输入内容经过HTML转义
- **路径安全**：服务器端防止路径遍历攻击
- **CORS配置**：合理的跨域策略
- **安全响应头**：防止点击劫持和MIME嗅探攻击

## 🛠️ 开发说明

### 代码组织
- 前端采用模块化设计，每个功能模块独立封装
- 使用ES6+特性（类、箭头函数、解构赋值等）
- CSS采用变量和现代特性，便于主题定制
- 完整的注释和文档

### 调试技巧
- 浏览器开发者工具查看网络请求
- Console查看应用日志
- Application标签页查看localStorage数据
- Performance标签页分析性能

## 📝 注意事项

1. **数据存储**：数据存储在浏览器本地，清除浏览器数据会丢失
2. **端口冲突**：如果3000端口被占用，可以使用其他端口
3. **浏览器兼容**：建议使用现代浏览器以获得最佳体验
4. **移动端**：部分动画效果在低端移动设备上可能受限

## 🎨 主题定制

可以通过修改CSS变量自定义主题：

```css
:root {
  --primary: #4cc9f0;      /* 主色调 */
  --secondary: #f72585;     /* 辅助色 */
  --accent: #4361ee;        /* 强调色 */
  --transition-speed: 0.3s; /* 动画速度 */
}
```

## 📞 问题反馈

如果在使用过程中遇到问题，请检查：
1. 浏览器是否支持现代CSS和JavaScript特性
2. localStorage是否可用（隐私模式可能受限）
3. 服务器端口是否被占用
4. 查看浏览器控制台错误信息

## 📄 许可证

MIT License

---

**开发时间**：2026年1月  
**版本**：2.0.0  
**优化重点**：性能、可维护性、用户体验
